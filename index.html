<!doctype html> <html lang="en"> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width,initial-scale=1"/> <title>AAMVA PDF417 Builder</title> <link rel="stylesheet" href="styles.css"/> </head> <body class="light"> <div class="page"> <header class="hdr"> <div class="hdr-top"> <h1 id="state-title">State</h1> <div class="hdr-tools"> <button class="tool">Scandit</button> <button class="tool">Show‑Me ID</button> <button class="tool">Veriscan</button> </div> </div> <div class="hdr-sub"> <span id="state-rev">Rev. 02/23/2020 (0900)</span> <span class="star" aria-label="pinned">★</span> </div> </header> <section id="banner" class="banner hidden"> <strong>Warning!</strong> You cannot create a barcode without logging in. </section> <section class="controls card"> <div class="ctrl-grid"> <label class="ctrl"> <span>Jurisdiction</span> <select id="jurisdiction"></select> </label> <label class="ctrl"> <span>Real ID</span> <select id="realid"> <option value="auto" selected>Auto (profile)</option> <option value="yes">Yes</option> <option value="no">No</option> </select> </label> <label class="ctrl"> <span>AAMVA Version</span> <input id="aamva" type="number" min="1" max="99" /> </label> <label class="ctrl"> <span>Entries</span> <input id="entries" type="number" min="1" max="99" value="1"/> </label> </div> </section> <main class="content"> <section class="form card"> <div class="form-grid" id="form-grid"> <!-- Dynamic fields rendered here per profile --> </div> <div class="actions sticky"> <button id="build" class="primary">Create</button> <button id="render" class="secondary">Render PDF417</button> <button id="download" class="secondary">Download PNG</button> <button id="selfcheck" class="ghost">Self‑check</button> <span id="status" class="muted"></span> </div> </section>
text
<aside class="side card">
  <div class="block">
    <div class="block-head">Raw Payload</div>
    <textarea id="payload" spellcheck="false" placeholder="Payload will appear here"></textarea>
    <div class="mini-actions">
      <button id="copyPayload" class="ghost">Copy</button>
    </div>
  </div>

  <div class="block">
    <div class="block-head">Barcode Preview</div>
    <canvas id="barcode" width="900" height="380"></canvas>
  </div>

  <div class="block">
    <div class="block-head">Diagnostics</div>
    <pre id="diag" class="diag"></pre>
  </div>
</aside>
</main> </div> <script src="vendor/pdf417.js"></script> <script src="profiles.js"></script> <script src="builder.js"></script> <script src="fixtures.js"></script> <script> // Minimal engine adapted to four-column grid without changing your builder (function(){ const $ = (id)=>document.getElementById(id); function setStateHeader(p){ $('state-title').textContent = p.label || p.id; $('state-rev').textContent = p.rev || 'Rev. 02/23/2020 (0900)'; } function inputRow(def){ const wrap=document.createElement('label'); wrap.className='ctrl'; const span=document.createElement('span'); span.textContent = def.label ? `${def.label}` : def.tag; const inp=document.createElement(def.tag==='DBC'||def.tag==='DAY'||def.tag==='DAZ'?'select':'input'); inp.id = 'f_'+def.tag; inp.placeholder = def.tag; if (def.tag==='DBC'){ ['1','2','9'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v==='1'?'M':v==='2'?'F':'X'; inp.appendChild(o); }); } if (def.tag==='DAY'){ ['BLK','BLU','BRO','DIC','GRY','GRN','HAZ','MAR','PNK','UNK'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; inp.appendChild(o); }); } if (def.tag==='DAZ'){ ['BAL','BLK','BLN','BRO','GRY','RED','SDY','WHI','UNK'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; inp.appendChild(o); }); } wrap.appendChild(span); wrap.appendChild(inp); return wrap; } function renderForm(profile){ const grid=$('form-grid'); grid.innerHTML=''; // Order similar to your screenshot rows const order = [ 'DAQ','DAC','DCS','DAD', 'DAG','DAI','DAK','DL_CLASS', // DL_CLASS placeholder — if profile lacks, it will be skipped 'DBB','DBD','DBA','DD', 'RESTR','ENDOR','DAU','WEIGHT', // placeholders for non-core if you add them to profile later 'DAY','DAZ','RACE','DCU' ]; const defined = new Set(profile.subfiles.fields.map(f=>f.tag)); function add(tag){ const def = profile.subfiles.fields.find(f=>f.tag===tag); if (def) grid.appendChild(inputRow(def)); } order.forEach(add); // Render any remaining defined fields not included above profile.subfiles.fields.forEach(def=>{ if (!order.includes(def.tag)) grid.appendChild(inputRow(def)); }); } function collectInputs(profile){ const values={}; profile.subfiles.fields.forEach(def=>{ const el=$('f_'+def.tag); values[def.tag]= el ? el.value : ''; }); return values; } function msg(text, cls){ const s=$('status'); s.textContent=text; s.className='muted '+(cls||'') } function renderBarcode(text){ const canvas=$('barcode'); try{ BWIPJS.toCanvas(canvas, { bcid:'pdf417', text, scale:2, columns:6, security:2, includetext:false, parse:false }); msg('Rendered','ok'); }catch(e){ msg('Render error: '+(e.message||e),'err'); } } function copyPayload(){ const ta=$('payload'); ta.select(); document.execCommand('copy'); msg('Copied payload','ok'); } function populateJurisdictions(){ const sel=$('jurisdiction'); sel.innerHTML=''; JURISDICTION_PROFILES.list.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=`${p.id} — ${p.label}`; sel.appendChild(o); }); sel.value=JURISDICTION_PROFILES.list.id; } function currentProfile(){ return JURISDICTION_PROFILES.map[$('jurisdiction').value]; } function selfCheck(profile){ const fix=(window.GOLDEN_FIXTURES&&window.GOLDEN_FIXTURES[profile.id])||[]; if(!fix.length){ $('diag').textContent='No fixtures for '+profile.id; return; } const errs=[]; for(const fx of fix){ try{ const { payload } = AAMVA_BUILDER.buildPayload(profile, fx.input, { aamvaVersion: profile.aamvaVersion, jurisdictionVersion: profile.jurisdictionVersion, entries: 1 }); if(payload!==fx.raw){ errs.push({case:fx.name||'case', diff:'payload mismatch'}); } }catch(e){ errs.push({case:fx.name||'case', error:e.message||String(e)}); } } $('diag').textContent = errs.length? JSON.stringify(errs,null,2) : 'All fixtures passed'; msg(errs.length?'Self‑check failed':'Self‑check passed', errs.length?'err':'ok'); } window.addEventListener('DOMContentLoaded', ()=>{ populateJurisdictions(); const p=currentProfile(); setStateHeader(p); renderForm(p); $('aamva').value = p.aamvaVersion ?? 10; $('jurisdiction').addEventListener('change', ()=>{ const np=currentProfile(); setStateHeader(np); renderForm(np); $('payload').value=''; $('diag').textContent=''; msg('',''); }); $('build').addEventListener('click', ()=>{ try{ const p=currentProfile(); const user=collectInputs(p); const { payload } = AAMVA_BUILDER.buildPayload(p, user, { aamvaVersion:Number($('aamva').value||p.aamvaVersion), jurisdictionVersion:p.jurisdictionVersion, entries:Number($('entries').value||1) }); $('payload').value = payload; msg('Payload built','ok'); }catch(e){ msg(e.message||String(e),'err'); } }); $('render').addEventListener('click', ()=>{ const t=$('payload').value; if(!t){ msg('Build first','warn'); return;} renderBarcode(t); }); $('download').addEventListener('click', ()=>{ const c=$('barcode'); const a=document.createElement('a'); a.href=c.toDataURL('image/png'); a.download='pdf417.png'; a.click(); }); $('selfcheck').addEventListener('click', ()=> selfCheck(currentProfile())); $('copyPayload').addEventListener('click', copyPayload); }); })(); </script> </body> </html>
